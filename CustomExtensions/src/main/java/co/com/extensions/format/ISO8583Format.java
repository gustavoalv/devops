/**
 * 
 */
package co.com.extensions.format;

import co.com.extensions.handlers.CustomExtensionsHandler;
import co.com.extensions.handlers.ISO8583Handler;

import com.itko.citi.Converter;



/**
 * @author alvgu02
 *
 */
public class ISO8583Format {
	
	private final static int HEADER_LEN = 2;
	
	/**
	 * @param argv
	 * @throws Exception
	 */
	public static void main(String argv[]) throws Exception {
		
		int messageLength = -1;
		
		messageLength = 240;
		String message1 = "&";
		
		String hexData = Converter.convertStringToHex(message1);
		
		
		int largo = message1.length();
		
		String longitud = Converter.convertIntToHex(largo);

		if(longitud.length()%2 != 0){
			longitud = "0" + longitud;
		}
		
		String resultHex = longitud + hexData;
		
		String final1 =Converter.convertHexToString(resultHex);
		
		String configfile = "E:\\Customers\\Colombia\\Colpatria\\Servicios_ISO8583_Documentados_09-09-2015\\8583-config.xml";

		// Conversion HEX a ISO8583 - Request 
		{
			String messageColpatria = "0320200F220848188E080000000000000000018160000000000000000945000000000005410033010525659839303300009006520900065209001585018600480056    000000000000000TOPY TOP CUSCO I &                      6040022046801000000     000000     REC     0000158 0146219471             15801001          000000000541000000000000                  00000000000                   00000000000                   00000000000 6040000000000000000005410          001V 00000005410                   15850186004801          00146219471                               00000005410000000054100000000000000000000000000000000000000000000000000000000000000000046219471                                         .";
			
			String result = messageColpatria;
			hexData = Converter.convertStringToHex(result);
			
			String resultString = ISO8583Handler.ISO8583Parser(configfile, hexData, 6, false, CustomExtensionsHandler.CONTENT_TYPE_HEXA );
			System.out.println(resultString);
			
			Object o = ISO8583Handler.ISO8583XmlToObject(resultString, "left", false, false);
			
			String responseIso = (String) o;
			
			/*
			String msgLength = Converter.convertIntToHex(responseIso.length()/2);
			
			while(msgLength.length()%4 != 0){
				msgLength = "0" + msgLength;
			}*/
			
			System.out.println("***************************************************");
			System.out.println("Archivo Procesado: ");
			System.out.println("Result: -" + responseIso + "-");
			System.out.println("Origin: -" + result.toUpperCase() + "-");
			
			System.out.println("Son iguales: " + responseIso.toUpperCase().equals(result.toUpperCase()));
			
			System.out.println("***************************************************");

			
		}
		

		// Conversion HEX a ISO8583 - Response
		{

//			String messageColpatria = "004649534f30303530303030353430383130383232303030303030323030303030303034303030303030303030303030303030313037323133363035303030303031303033303103";
//			String messageColpatria = "028149534f303235303030303533303231304232334338343831324543393834314130303030303030303134303030304443303033303030303030303030303130303030303130373231313730383135313630353136333332333031303732303031303130373031323038313131373030303031303031393337343039373434363439313735313639303d323030312020202020202020202020202020202030303030303231353136303530303030303035343030303032202020202020202020202030313032202020202020203030303037362020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202030323730303030303030303030303032303033303231303030303030303031373030313220202020202020202020202030313630303930544553313030303020202020303139303031395445533130333030303030303030303131342620303030303330303131342120433030303032362020202020202020202020202020202020202032302020202020202120514530303035362020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203131313030303030303030313932383430393734343634393137353136393020202020202020202020202030323020202020202020202020202020202020202050303031312020202020202020202020303039303030303030303030303132562042323420423234203120303338303030202020202020202020202020202020202020202020202020202020202020202020202003";
			
//			String messageColpatria = "028149534F303236303030303130303230304232333838343031323841333934314130303030303030303130303030303944303031303030303030303033303030303030303632373136313831313030303936393131313831313036323730363237303531313131303030303030303030373337353839353236303030303430303332383431383D35333031323230303631303030302020203030303030303030303236384C413030303030322020202020202020484F54454C205052554542412020202020202020202031313030313030424F474F544143554E434F3033363030303030303030303030303030303030303030303030303030303030303030303030303032373030313032303330343020202020202020202030303031303030313137303135303434383530413238454238423830313230303030303030303030303030313630303037544553312B30303030303030303139303139302020202030303030303030303030303035382620303030303230303035382120503030303033362030303030303030303030303030303030303030303030303030303030303030303030303031313130303030303030313930303230202020202020202020202020202020202020202030303930353230323430303130313250204232342042323420313030333830303030303030303030303030303034323838303030202020202020202020202020203030303333314239364433303030303030303003";
			
			String messageSenae = "00ISO0040000730210F02200000A000000000000000000001433110860           310001000002984298000368082400000694165700120& 0000200120! T100098 1791249879001LILE S.A.                               05505520151000521452             000000000000085& 0000200085! T300063 004000000036785110501007000001108076110404008000001839437110503";
			
			String messageColpatria = "0210B22080010E80800000000000000000189450000000000054100330105256598393033006520900158501860048000000000056    60400220557010000000000000000000000REC     0000158 0146219471             1580000000000000000342491600100100000000000000ejecutado satisfactoriamente. BENITES JUAN                                                                001PAGO SERV. LUZ.00000005410                                                                                 1                    000                                                      2015122120160107000000054100100000005410  00000000000  00000000000  00000000000  0000000000000000000000046219471                                          ";
			String result = messageColpatria;
			
			hexData = Converter.convertStringToHex(result);
			
			// HEX
			String resultString = ISO8583Handler.ISO8583Parser(configfile, hexData, 0, false, CustomExtensionsHandler.CONTENT_TYPE_HEXA );
	
			System.out.println(resultString);
			
			Object o = ISO8583Handler.ISO8583XmlToObject(resultString, "left", false, false);
			
			String responseIso = (String) o;
			System.out.println("***************************************************");
			System.out.println("Archivo Procesado: ");
			System.out.println("Result: -" + responseIso + "-");
			System.out.println("Origin: -" + result.toUpperCase() + "-");
			
			System.out.println("Son iguales: " + responseIso.equalsIgnoreCase(result.toUpperCase()));
			
			System.out.println("***************************************************");
			
		}
 
	}

}
